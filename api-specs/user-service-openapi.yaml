openapi: 3.1.0
info:
  title: OpenAPI definition
  version: v0
servers:
- url: http://localhost:8081
  description: Generated server url
tags:
- name: Users
  description: User management operations
- name: Authentication
  description: User authentication operations
paths:
  /api/v0.0.1/users/{id}:
    get:
      tags:
      - Users
      summary: Get user by ID
      description: Retrieves a specific user by their UUID. Requires authentication.
      operationId: getUser
      parameters:
      - name: X-User-Id
        in: header
        required: false
        schema:
          type: string
          format: uuid
      - name: id
        in: path
        description: User ID
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "404":
          description: User not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "200":
          description: User found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserDto"
    put:
      tags:
      - Users
      summary: Update user
      description: Updates an existing user's information. ADMIN only.
      operationId: updateUser
      parameters:
      - name: X-User-Role
        in: header
        required: false
        schema:
          type: string
      - name: id
        in: path
        description: User ID
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
        required: true
      responses:
        "404":
          description: User not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: User is not ADMIN
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "200":
          description: User updated successfully
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserDto"
        "400":
          description: Invalid request data
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/UserDto"
    delete:
      tags:
      - Users
      summary: Delete user
      description: Deletes a user and all their associated data. ADMIN only.
      operationId: deleteUser
      parameters:
      - name: X-User-Role
        in: header
        required: false
        schema:
          type: string
      - name: id
        in: path
        description: User ID
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "404":
          description: User not found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: User is not ADMIN
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "204":
          description: User deleted successfully
  /api/v0.0.1/users:
    get:
      tags:
      - Users
      summary: Get paginated list of users
      description: Retrieves a paginated list of all users in the system. Requires
        authentication.
      operationId: getUsers
      parameters:
      - name: X-User-Id
        in: header
        required: false
        schema:
          type: string
          format: uuid
      - name: page
        in: query
        description: Page number (0-based)
        required: false
        schema:
          type: integer
          format: int32
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Page size (max 50)
        required: false
        schema:
          type: integer
          format: int32
          default: 20
          maximum: 50
          minimum: 1
        example: 20
      responses:
        "404":
          description: Not Found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "200":
          description: Users retrieved successfully
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserDto"
    post:
      tags:
      - Users
      summary: Create a new user
      description: Creates a new user with username and password. ADMIN only. ID and
        timestamp are generated by PostgreSQL. Returns only the generated ID. Returns
        409 if username already exists.
      operationId: createUser
      parameters:
      - name: X-User-Role
        in: header
        required: false
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
        required: true
      responses:
        "404":
          description: Not Found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: User with this username already exists
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: User is not ADMIN
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "400":
          description: Invalid request data or weak password
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/CreateUserResponse"
        "201":
          description: "User created successfully, returns generated ID"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/CreateUserResponse"
  /api/v0.0.1/auth/login:
    post:
      tags:
      - Authentication
      summary: Authenticate user
      description: "Authenticates user with username and password, returns JWT token"
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
        required: true
      responses:
        "404":
          description: Not Found
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Invalid credentials
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "200":
          description: "Authentication successful, returns JWT token"
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/AuthTokenResponse"
        "400":
          description: Invalid request data
          content:
            '*/*':
              schema:
                $ref: "#/components/schemas/AuthTokenResponse"
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time
        path:
          type: string
      required:
      - error
      - message
      - timestamp
    UpdateUserRequest:
      type: object
      properties:
        username:
          type: string
          maxLength: 128
          minLength: 1
        password:
          type: string
          maxLength: 2147483647
          minLength: 8
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&#])[A-Za-z\\d@$!%*?&#]+$"
    UserDto:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        role:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
      - createdAt
      - id
      - role
      - username
    CreateUserRequest:
      type: object
      properties:
        username:
          type: string
          maxLength: 128
          minLength: 1
        password:
          type: string
          maxLength: 2147483647
          minLength: 8
          pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&#])[A-Za-z\\d@$!%*?&#]+$"
      required:
      - password
      - username
    CreateUserResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
      required:
      - id
    LoginRequest:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
      - password
      - username
    AuthTokenResponse:
      type: object
      properties:
        token:
          type: string
        expiresAt:
          type: string
          format: date-time
        username:
          type: string
        role:
          type: string
      required:
      - expiresAt
      - role
      - token
      - username
